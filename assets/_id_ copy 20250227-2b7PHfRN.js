import{ah as xe,_ as ye,$ as ke,x as T,o as ae,ab as we,a4 as d,ag as Fe,aE as Ue,a0 as Ce,a1 as De,a2 as U,c as a,az as Se,aa as i,aA as te,aB as Pe,aC as le,a5 as C,a6 as D,a9 as oe,al as t,a3 as E,a8 as I,a7 as j,ad as r,ay as v,aD as ze}from"./index-BIOJ7wy9.js";import{c as Ae,a as g,b as p,u as Be,d as u,V as $e}from"./index.esm-EU4o9Pf6.js";import{b as ne}from"./route-block-B_A1xBdJ.js";import{V as Me}from"./VContainer-BzB05Dvr.js";import{V as se}from"./VDivider-B64AXrpT.js";import{V as S,a as c}from"./VRow-DUv8sevy.js";import{V as de}from"./VTable-DRSk5jhg.js";const Ne={class:"my-6"},Re={class:"text-h6 mr-2"},Te={class:"my-6"},Ee={class:"my-6"},Ie={class:"text-h6"},je={class:"text-h6"},Ke={class:"text-h6"},Le={class:"text-h6"},Oe={class:"my-6"},He={class:"text-h6"},We={class:"text-h6"},Xe={class:"my-6"},Ze={class:"text-h6"},qe={class:"text-h6"},Ge={class:"my-6"},ue=25,ie={__name:"[id] copy 20250227",setup(Je){const{apiAuth:P}=Fe(),pe=Ue(),z=Ce(),re=ye(),K=ke(),n=T({_id:"",version:"",investigator_name:"",occupation:"",colleges_degrees:"",birthplace:"",mental_disorders:"",sex:"",age:"",str:0,con:0,pow:0,dex:0,app:0,siz:0,int:0,edu:0,idea:0,know:0,luck:0,hp:0,mp:0,san:0,db:"0",opspothidden:0,ipspothidden:0,gpspothidden:0,image:""});(async()=>{try{const{data:e}=await P.get("/charasheetsix/"+pe.params.id);console.log(e),n.value=e.result,document.title=n.value.investigator_name+" | 調查員之家",L.setValue(n.value.investigator_name),O.setValue(n.value.occupation),H.setValue(n.value.colleges_degrees),W.setValue(n.value.birthplace),X.setValue(n.value.mental_disorders),Z.setValue(n.value.sex),q.setValue(n.value.age),A.setValue(n.value.str),B.setValue(n.value.con),f.setValue(n.value.pow),G.setValue(n.value.dex),J.setValue(n.value.app),x.setValue(n.value.siz),y.setValue(n.value.int),k.setValue(n.value.edu),ve.setValue(n.value.idea),ge.setValue(n.value.know),he.setValue(n.value.luck),$.setValue(n.value.hp),M.setValue(n.value.mp),N.setValue(n.value.san),fe.setValue(n.value.db),b.setValue(n.value.opspothidden),V.setValue(n.value.ipspothidden),w.setValue(n.value.gpspothidden)}catch(e){console.log(e),z.push("/")}})();const ce=Ae({investigator_name:g().default(""),occupation:g().default(""),colleges_degrees:g().default(""),birthplace:g().default(""),mental_disorders:g().default(""),sex:g().default(""),age:g().default(""),str:p().integer().default(0),con:p().integer().default(0),pow:p().integer().default(0),dex:p().integer().default(0),app:p().integer().default(0),siz:p().integer().default(0),int:p().integer().default(0),edu:p().integer().default(0),idea:p().integer().default(0),know:p().integer().default(0),luck:p().integer().default(0),hp:p().integer().default(0),mp:p().integer().default(0),san:p().integer().default(0),db:g().default(""),opspothidden:p().integer().default(0),ipspothidden:p().integer().default(0),gpspothidden:p().integer().default(0)}),{handleSubmit:me,isSubmitting:h}=Be({validationSchema:ce}),L=u("investigator_name"),O=u("occupation"),H=u("colleges_degrees"),W=u("birthplace"),X=u("mental_disorders"),Z=u("sex"),q=u("age"),A=u("str"),B=u("con"),f=u("pow"),G=u("dex"),J=u("app"),x=u("siz"),y=u("int"),k=u("edu"),ve=u("idea"),ge=u("know"),he=u("luck"),$=u("hp"),M=u("mp"),N=u("san"),fe=u("db"),b=u("opspothidden"),V=u("ipspothidden"),w=u("gpspothidden"),be=[{label:"姓名",model:L},{label:"職業",model:O},{label:"學校・學位",model:H},{label:"出身",model:W},{label:"精神障害",model:X},{label:"性別",model:Z},{label:"年齡",model:q}],Q=[{label:"STR",model:A},{label:"CON",model:B},{label:"POW",model:f},{label:"DEX",model:G},{label:"APP",model:J},{label:"SIZ",model:x},{label:"INT",model:y},{label:"EDU",model:k}],_=T([]),Y=T([]),m=ae(()=>({hp:Math.ceil(((parseFloat(B.value.value)||0)+(parseFloat(x.value.value)||0))/2),mp:parseFloat(f.value.value)||0,idea:parseFloat(y.value.value*5)||0,know:parseFloat(k.value.value*5)||0,luck:parseFloat(f.value.value*5)||0,san:parseFloat(f.value.value*5)||0,occupationpoints:parseFloat(k.value.value)*20||0,moveoccupationpoints:parseFloat(b.value.value)||0,interestpoints:parseFloat(y.value.value)*10||0,moveinterestpoints:parseFloat(V.value.value)||0,totalspothidden:ue+(parseFloat(b.value.value)||0)+(parseFloat(V.value.value)||0)+(parseFloat(w.value.value)||0)})),Ve=ae(()=>{const e=(parseFloat(A.value.value)||0)+(parseFloat(x.value.value)||0);return e<=12?"-1D6":e<=16?"-1D4":e<=24?"0":e<=32?"+1D4":e<=40?"+1D6":`+${Math.floor((e-25)/16)+1}D6`}),_e=me(async e=>{var o,F,s;if(!re.isLoggedIn){z.push("/login");return}try{console.log("按完送出:",e);const l=new FormData;l.append("investigator_name",e.investigator_name),l.append("occupation",e.occupation),l.append("colleges_degrees",e.colleges_degrees),l.append("birthplace",e.birthplace),l.append("mental_disorders",e.mental_disorders),l.append("sex",e.sex),l.append("age",e.age),l.append("str",e.str),l.append("con",e.con),l.append("pow",e.pow),l.append("dex",e.dex),l.append("app",e.app),l.append("siz",e.siz),l.append("int",e.int),l.append("edu",e.edu),l.append("idea",e.idea),l.append("know",e.know),l.append("luck",e.luck),l.append("hp",e.hp),l.append("mp",e.mp),l.append("san",e.san),l.append("db",e.db),l.append("opspothidden",e.opspothidden),l.append("ipspothidden",e.ipspothidden),l.append("gpspothidden",e.gpspothidden),_.value.length>0&&((o=_.value[0])!=null&&o.file)&&l.append("image",_.value[0].file);const R=n.value._id;await P.patch(`/charasheetsix/${R}`,l),K({text:"保存成功",snackbarProps:{color:"green"}})}catch(l){console.log(l),K({text:((s=(F=l==null?void 0:l.response)==null?void 0:F.data)==null?void 0:s.message)||"unknownError",snackbarProps:{color:"red"}})}}),ee=async()=>{if(confirm(`確定要刪除角色卡「${n.value.investigator_name}」嗎？`)){h.value=!0;try{const e=n.value._id;await P.delete(`/charasheetsix/${e}`),z.push("/charalist")}catch(e){console.log("刪除失敗",e),alert("刪除失敗，請稍後再試！")}finally{h.value=!1}}};return(e,o)=>{const F=De("VueFileAgent");return U(),we(Me,null,{default:d(()=>[a(ze,{"max-width":"800",class:"mx-auto",variant:"text"},{default:d(()=>[a(Se,null,{default:d(()=>[a($e,{disabled:i(h),onSubmit:te(i(_e),["prevent"]),onKeydown:o[8]||(o[8]=Pe(te(()=>{},["prevent"]),["enter"]))},{default:d(()=>[a(le,null,{default:d(()=>[a(C,{type:"submit",loading:i(h),variant:"outlined"},{default:d(()=>o[9]||(o[9]=[D(" 儲存 ")])),_:1},8,["loading"]),a(oe),a(C,{color:"red",loading:i(h),variant:"outlined",onClick:ee},{default:d(()=>o[10]||(o[10]=[D(" 刪除 ")])),_:1},8,["loading"])]),_:1}),a(se),t("section",Ne,[a(S,{align:"center",justify:"center"},{default:d(()=>[(U(),E(j,null,I(be,s=>a(c,{key:s.label,cols:"12",class:"d-flex align-center"},{default:d(()=>[t("label",Re,r(s.label),1),a(v,{modelValue:s.model.value.value,"onUpdate:modelValue":l=>s.model.value.value=l,type:"text",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),64)),a(c,{cols:"3"},{default:d(()=>[o[11]||(o[11]=t("label",{class:"text-h6"},"調查員圖像",-1)),a(F,{ref:"fileAgent",modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=s=>_.value=s),"raw-model-value":Y.value,"onUpdate:rawModelValue":o[1]||(o[1]=s=>Y.value=s),accept:"image/jpeg, image/png",deletable:"","max-size":"1MB","help-text":"點擊選取圖片或拖曳圖片"},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1})]),t("section",Te,[a(de,{class:"border"},{default:d(()=>[t("thead",null,[t("tr",null,[(U(),E(j,null,I(Q,(s,l)=>t("th",{key:l,class:"text-h6"},r(s.label),1)),64))])]),t("tbody",null,[t("tr",null,[(U(),E(j,null,I(Q,(s,l)=>t("td",{key:l},[a(v,{modelValue:s.model.value.value,"onUpdate:modelValue":R=>s.model.value.value=R,type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),64))])])]),_:1})]),t("section",Ee,[a(S,null,{default:d(()=>[a(c,{cols:"2"},{default:d(()=>[t("label",Ie,"Idea："+r(m.value.idea),1)]),_:1}),a(c,{cols:"2"},{default:d(()=>[t("label",je,"Know："+r(m.value.know),1)]),_:1}),a(c,{cols:"2"},{default:d(()=>[t("label",Ke,"Luck："+r(m.value.luck),1)]),_:1}),a(c,{cols:"2"},{default:d(()=>[t("label",Le,"DB："+r(Ve.value),1)]),_:1})]),_:1})]),t("section",Oe,[a(S,null,{default:d(()=>[a(c,{cols:"2"},{default:d(()=>[t("label",He,"HP："+r(m.value.hp),1),a(v,{modelValue:i($).value.value,"onUpdate:modelValue":o[2]||(o[2]=s=>i($).value.value=s),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1}),a(c,{cols:"2",class:"text-h6"},{default:d(()=>[t("label",null,"MP："+r(m.value.mp),1),a(v,{modelValue:i(M).value.value,"onUpdate:modelValue":o[3]||(o[3]=s=>i(M).value.value=s),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1}),a(c,{cols:"2"},{default:d(()=>[t("label",We,"SAN："+r(m.value.san),1),a(v,{modelValue:i(N).value.value,"onUpdate:modelValue":o[4]||(o[4]=s=>i(N).value.value=s),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),a(se),t("section",Xe,[a(S,{justify:"start",align:"center"},{default:d(()=>[a(c,{cols:"2"},{default:d(()=>o[12]||(o[12]=[t("label",{class:"text-h4"},"技能",-1)])),_:1}),a(c,{cols:"4"},{default:d(()=>[t("label",Ze,"職業技能點數："+r(m.value.occupationpoints)+"/"+r(m.value.moveoccupationpoints),1)]),_:1}),a(c,{cols:"4"},{default:d(()=>[t("label",qe,"興趣技能點數："+r(m.value.interestpoints)+"/"+r(m.value.moveinterestpoints),1)]),_:1})]),_:1})]),t("section",Ge,[a(de,{class:"border"},{default:d(()=>[o[14]||(o[14]=t("thead",null,[t("tr",null,[t("th",null,"技能"),t("th",null,"初始值"),t("th",null,"職業P"),t("th",null,"興趣P"),t("th",null,"成長P"),t("th",null,"合計")])],-1)),t("tbody",null,[t("tr",null,[o[13]||(o[13]=t("td",null,"偵查",-1)),t("td",null,r(ue)),t("td",null,[a(v,{modelValue:i(b).value.value,"onUpdate:modelValue":o[5]||(o[5]=s=>i(b).value.value=s),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),t("td",null,[a(v,{modelValue:i(V).value.value,"onUpdate:modelValue":o[6]||(o[6]=s=>i(V).value.value=s),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),t("td",null,[a(v,{modelValue:i(w).value.value,"onUpdate:modelValue":o[7]||(o[7]=s=>i(w).value.value=s),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),t("td",null,r(m.value.totalspothidden),1)])])]),_:1})]),a(le,null,{default:d(()=>[a(C,{type:"submit",loading:i(h),variant:"outlined"},{default:d(()=>o[15]||(o[15]=[D(" 儲存 ")])),_:1},8,["loading"]),a(oe),a(C,{color:"red",loading:i(h),variant:"outlined",onClick:ee},{default:d(()=>o[16]||(o[16]=[D(" 刪除 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})}}};typeof ne=="function"&&ne(ie);const sa=xe(ie,[["__scopeId","data-v-c40a3953"]]);export{sa as default};
