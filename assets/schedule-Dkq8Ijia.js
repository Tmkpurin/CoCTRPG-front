import{ah as j,x as o,ab as T,a4 as n,a2 as P,c as a,aa as D,aD as w,b1 as h,a6 as c,ad as z,az as U,ay as x,aB as g,bt as I,aC as L,a9 as O,a5 as k,ac as G,ag as H}from"./index-7qtL3Bw3.js";import{i as R,a as W,F as X,V as Y}from"./VTimePicker-lqvTbZ9S.js";import{b as S}from"./route-block-B_A1xBdJ.js";import{V as q}from"./VContainer-BtWKigHT.js";import{V as J}from"./VDivider-DbTWzxOK.js";const K={__name:"schedule",setup(Q){const{apiAuth:f}=H(),V=o([]),d=o(!1),C=o(""),r=o(""),v=o(""),i=o(""),s=o(""),y=o(!1),b=o(""),u=o(null),$=o(""),p=o({plugins:[R,W],initialView:"dayGridMonth",editable:!0,events:V.value,displayEventTime:!1,dateClick:M,eventClick:A,eventDrop:N,eventMouseEnter:B});function B(t){const e=t.event;$.value=`劇本: ${e.title}<br>玩家: ${e.extendedProps.player}<br>角色: ${e.extendedProps.chara}<br>時間: ${e.extendedProps.time}`;const l=document.createElement("div");l.innerHTML=$.value,l.style.position="absolute",l.style.backgroundColor="rgba(0, 0, 0, 0.7)",l.style.color="white",l.style.padding="10px",l.style.borderRadius="4px",l.style.zIndex="1000",l.style.top=`${t.jsEvent.pageY}px`,l.style.left=`${t.jsEvent.pageX}px`,document.body.appendChild(l),t.el.addEventListener("mouseleave",()=>{l.remove()})}function M(t){C.value="新增行程",r.value="",v.value="",i.value="",s.value="",b.value=t.dateStr,u.value=null,d.value=!0}function A(t){C.value="編輯行程",r.value=t.event.title,v.value=t.event.extendedProps.player,i.value=t.event.extendedProps.chara,s.value=t.event.extendedProps.time,b.value=t.event.extendedProps.date,u.value=t.event,d.value=!0}async function m(){try{if(!r.value.trim()){alert("行程名稱不能為空");return}const t={title:r.value,player:v.value,chara:i.value,time:s.value,date:b.value};if(u.value){const e=u.value.id;await f.patch(`/schedule/${e}`,t)}else await f.post("/schedule",t);console.log(p.value.events),E(),console.log(p.value.events)}catch(t){console.log(t)}d.value=!1}async function F(){if(u.value&&confirm(`確定要刪除「${u.value.title}」嗎？`)){const t=u.value.id;p.value.events=p.value.events.filter(e=>e.id!==t);try{await f.delete(`/schedule/${t}`),d.value=!1}catch(e){console.log(e)}}}function N(t){alert(`行程「${t.event.title}」已移動到 ${t.event.start.toISOString().split("T")[0]}`)}const E=async()=>{try{const{data:t}=await f.get("/schedule");console.log(t.result);const e=t.result.map(l=>({id:l._id,title:l.title,player:l.player,chara:l.chara,time:l.time,date:l.date}));V.value.length=0,V.value.push(...e),console.log(V.value)}catch(t){console.log(t)}console.log()};return E(),(t,e)=>(P(),T(q,null,{default:n(()=>[a(w,{class:"calendar-wrapper","max-width":"800px"},{default:n(()=>[a(D(X),{options:p.value},null,8,["options"])]),_:1}),a(I,{modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=l=>d.value=l),"max-width":"400px"},{default:n(()=>[a(w,null,{default:n(()=>[a(h,null,{default:n(()=>[c(z(C.value),1)]),_:1}),a(U,null,{default:n(()=>[a(x,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),label:"劇本名稱",onKeydown:g(m,["enter"])},null,8,["modelValue"]),a(x,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),label:"玩家名稱",onKeydown:g(m,["enter"])},null,8,["modelValue"]),a(x,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l),label:"角色名稱",onKeydown:g(m,["enter"])},null,8,["modelValue"]),a(x,{modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value=l),label:"點擊此處選擇時間",readonly:"",onKeydown:g(m,["enter"]),onClick:e[4]||(e[4]=l=>y.value=!0)},null,8,["modelValue"]),a(I,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=l=>y.value=l),"max-width":"380px"},{default:n(()=>[a(w,null,{default:n(()=>[a(h,null,{default:n(()=>e[10]||(e[10]=[c("選擇時間")])),_:1}),a(U,null,{default:n(()=>[a(D(Y),{modelValue:s.value,"onUpdate:modelValue":[e[5]||(e[5]=l=>s.value=l),e[6]||(e[6]=l=>y.value=!1)],format:"24hr"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(L,null,{default:n(()=>[a(O),u.value?(P(),T(k,{key:0,color:"red",onClick:F},{default:n(()=>e[11]||(e[11]=[c("刪除")])),_:1})):G("",!0),a(J),a(k,{color:"grey",onClick:e[8]||(e[8]=l=>d.value=!1)},{default:n(()=>e[12]||(e[12]=[c("取消")])),_:1}),a(k,{color:"primary",onClick:m},{default:n(()=>e[13]||(e[13]=[c("確定")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};typeof S=="function"&&S(K);const ae=j(K,[["__scopeId","data-v-8c489282"]]);export{ae as default};
