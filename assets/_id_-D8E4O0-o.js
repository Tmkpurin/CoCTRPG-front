import{ah as Pe,_ as ze,$ as Be,x as W,o as ie,ab as re,a4 as u,ag as $e,aE as Ne,a0 as Te,a1 as Ie,a2 as U,c as a,az as Me,aa as d,aA as pe,aB as Re,aC as me,a5 as $,a6 as N,a9 as ce,al as l,a3 as X,a8 as Z,a7 as q,V as Ee,ac as je,ad as p,ay as c,aD as Ke}from"./index-BIOJ7wy9.js";import{c as Le,a as g,b as r,u as Oe,d as i,V as He}from"./index.esm-EU4o9Pf6.js";import{b as ve}from"./route-block-B_A1xBdJ.js";import{V as We}from"./VContainer-BzB05Dvr.js";import{V as T}from"./VDivider-B64AXrpT.js";import{V,a as m}from"./VRow-DUv8sevy.js";import{V as ge}from"./VTable-DRSk5jhg.js";import{V as Xe}from"./VTextarea-BtmeLhZE.js";const Ze={class:"my-6"},qe={class:"text-h6 mr-2"},Ge={class:"my-6"},Je={class:"my-6"},Qe={class:"text-h6"},Ye={class:"text-h6"},el={class:"text-h6"},ll={class:"text-h6"},al={class:"my-6"},tl={class:"text-h6"},nl={class:"text-h6"},ol={class:"my-6"},sl={class:"text-h6"},ul={class:"text-h6"},dl={class:"my-6"},il={class:"my-6"},rl={class:"my-6"},be=25,Ve=25,fe=25,he={__name:"[id]",setup(pl){const{apiAuth:I}=$e(),ye=Ne(),M=Te(),xe=ze(),G=Be(),s=W({_id:"",version:"",investigator_name:"",occupation:"",colleges_degrees:"",birthplace:"",mental_disorders:"",sex:"",age:"",str:0,con:0,pow:0,dex:0,app:0,siz:0,int:0,edu:0,idea:0,know:0,luck:0,hp:0,mp:0,san:0,db:"0",opspothidden:0,ipspothidden:0,gpspothidden:0,oplisten:0,iplisten:0,gplisten:0,oplibraryuse:0,iplibraryuse:0,gplibraryuse:0,background:"",image:""});(async()=>{try{const{data:t}=await I.get("/charasheetsix/"+ye.params.id);console.log(t),s.value=t.result,document.title=s.value.investigator_name+" | 調查員之家",J.setValue(s.value.investigator_name),Q.setValue(s.value.occupation),Y.setValue(s.value.colleges_degrees),ee.setValue(s.value.birthplace),le.setValue(s.value.mental_disorders),ae.setValue(s.value.sex),te.setValue(s.value.age),R.setValue(s.value.str),E.setValue(s.value.con),f.setValue(s.value.pow),ne.setValue(s.value.dex),oe.setValue(s.value.app),C.setValue(s.value.siz),D.setValue(s.value.int),S.setValue(s.value.edu),Fe.setValue(s.value.idea),we.setValue(s.value.know),Ue.setValue(s.value.luck),j.setValue(s.value.hp),K.setValue(s.value.mp),L.setValue(s.value.san),Ce.setValue(s.value.db),h.setValue(s.value.opspothidden),y.setValue(s.value.ipspothidden),A.setValue(s.value.gpspothidden),x.setValue(s.value.oplisten),_.setValue(s.value.iplisten),P.setValue(s.value.gplisten),k.setValue(s.value.oplibraryuse),F.setValue(s.value.iplibraryuse),z.setValue(s.value.gplibraryuse),O.setValue(s.value.background)}catch(t){console.log(t),M.push("/")}})();const _e=Le({investigator_name:g().default(""),occupation:g().default(""),colleges_degrees:g().default(""),birthplace:g().default(""),mental_disorders:g().default(""),sex:g().default(""),age:g().default(""),str:r().integer().default(0),con:r().integer().default(0),pow:r().integer().default(0),dex:r().integer().default(0),app:r().integer().default(0),siz:r().integer().default(0),int:r().integer().default(0),edu:r().integer().default(0),hp:r().integer().default(0),mp:r().integer().default(0),san:r().integer().default(0),opspothidden:r().integer().default(0),ipspothidden:r().integer().default(0),gpspothidden:r().integer().default(0),oplisten:r().integer().default(0),iplisten:r().integer().default(0),gplisten:r().integer().default(0),oplibraryuse:r().integer().default(0),iplibraryuse:r().integer().default(0),gplibraryuse:r().integer().default(0),background:g().default("")}),{handleSubmit:ke,isSubmitting:b}=Oe({validationSchema:_e}),J=i("investigator_name"),Q=i("occupation"),Y=i("colleges_degrees"),ee=i("birthplace"),le=i("mental_disorders"),ae=i("sex"),te=i("age"),R=i("str"),E=i("con"),f=i("pow"),ne=i("dex"),oe=i("app"),C=i("siz"),D=i("int"),S=i("edu"),Fe=i("idea"),we=i("know"),Ue=i("luck"),j=i("hp"),K=i("mp"),L=i("san"),Ce=i("db"),h=i("opspothidden"),y=i("ipspothidden"),A=i("gpspothidden"),x=i("oplisten"),_=i("iplisten"),P=i("gplisten"),k=i("oplibraryuse"),F=i("iplibraryuse"),z=i("gplibraryuse"),O=i("background"),De=[{label:"姓名",model:J},{label:"職業",model:Q},{label:"學校・學位",model:Y},{label:"出身",model:ee},{label:"精神障礙",model:le},{label:"性別",model:ae},{label:"年齡",model:te}],se=[{label:"STR",model:R},{label:"CON",model:E},{label:"POW",model:f},{label:"DEX",model:ne},{label:"APP",model:oe},{label:"SIZ",model:C},{label:"INT",model:D},{label:"EDU",model:S}],w=W([]),ue=W([]),v=ie(()=>({hp:Math.ceil(((parseFloat(E.value.value)||0)+(parseFloat(C.value.value)||0))/2),mp:parseFloat(f.value.value)||0,idea:parseFloat(D.value.value*5)||0,know:parseFloat(S.value.value*5)||0,luck:parseFloat(f.value.value*5)||0,san:parseFloat(f.value.value*5)||0,occupationpoints:parseFloat(S.value.value)*20||0,moveoccupationpoints:(parseFloat(h.value.value)||0)+(parseFloat(x.value.value)||0)+(parseFloat(k.value.value)||0),interestpoints:parseFloat(D.value.value)*10||0,moveinterestpoints:(parseFloat(y.value.value)||0)+(parseFloat(_.value.value)||0)+(parseFloat(F.value.value)||0),totalspothidden:be+(parseFloat(h.value.value)||0)+(parseFloat(y.value.value)||0)+(parseFloat(A.value.value)||0),totallisten:Ve+(parseFloat(x.value.value)||0)+(parseFloat(_.value.value)||0)+(parseFloat(P.value.value)||0),totallibraryuse:fe+(parseFloat(k.value.value)||0)+(parseFloat(F.value.value)||0)+(parseFloat(z.value.value)||0)})),Se=ie(()=>{const t=(parseFloat(R.value.value)||0)+(parseFloat(C.value.value)||0);return t<=12?"-1D6":t<=16?"-1D4":t<=24?"0":t<=32?"+1D4":t<=40?"+1D6":`+${Math.floor((t-25)/16)+1}D6`}),Ae=ke(async t=>{var e,B,o;if(console.log("按完送出:",t),!xe.isLoggedIn){M.push("/login");return}try{console.log("按完送出:",t);const n=new FormData;n.append("investigator_name",t.investigator_name),n.append("occupation",t.occupation),n.append("colleges_degrees",t.colleges_degrees),n.append("birthplace",t.birthplace),n.append("mental_disorders",t.mental_disorders),n.append("sex",t.sex),n.append("age",t.age),n.append("str",t.str),n.append("con",t.con),n.append("pow",t.pow),n.append("dex",t.dex),n.append("app",t.app),n.append("siz",t.siz),n.append("int",t.int),n.append("edu",t.edu),n.append("idea",t.idea),n.append("know",t.know),n.append("luck",t.luck),n.append("hp",t.hp),n.append("mp",t.mp),n.append("san",t.san),n.append("db",t.db),n.append("opspothidden",t.opspothidden),n.append("ipspothidden",t.ipspothidden),n.append("gpspothidden",t.gpspothidden),n.append("oplisten",t.oplisten),n.append("iplisten",t.iplisten),n.append("gplisten",t.gplisten),n.append("oplibraryuse",t.oplibraryuse),n.append("iplibraryuse",t.iplibraryuse),n.append("gplibraryuse",t.gplibraryuse),n.append("background",t.background),w.value.length>0&&((e=w.value[0])!=null&&e.file)&&n.append("image",w.value[0].file);const H=s.value._id;await I.patch(`/charasheetsix/${H}`,n),G({text:"保存成功",snackbarProps:{color:"green"}})}catch(n){console.log(n),G({text:((o=(B=n==null?void 0:n.response)==null?void 0:B.data)==null?void 0:o.message)||"unknownError",snackbarProps:{color:"red"}})}}),de=async()=>{if(confirm(`確定要刪除角色卡「${s.value.investigator_name}」嗎？`)){b.value=!0;try{const t=s.value._id;await I.delete(`/charasheetsix/${t}`),M.push("/charalist")}catch(t){console.log("刪除失敗",t),alert("刪除失敗，請稍後再試！")}finally{b.value=!1}}};return(t,e)=>{const B=Ie("VueFileAgent");return U(),re(We,{width:"800px",fluid:""},{default:u(()=>[a(Ke,{"max-width":"auto",class:"mx-auto",variant:"text"},{default:u(()=>[a(Me,null,{default:u(()=>[a(He,{disabled:d(b),onSubmit:pe(d(Ae),["prevent"]),onKeydown:e[15]||(e[15]=Re(pe(()=>{},["prevent"]),["enter"]))},{default:u(()=>[a(me,null,{default:u(()=>[a($,{type:"submit",loading:d(b),variant:"outlined"},{default:u(()=>e[16]||(e[16]=[N(" 儲存 ")])),_:1},8,["loading"]),a(ce),a($,{color:"red",loading:d(b),variant:"outlined",onClick:de},{default:u(()=>e[17]||(e[17]=[N(" 刪除 ")])),_:1},8,["loading"])]),_:1}),a(T),l("section",Ze,[a(V,{align:"center",justify:"center"},{default:u(()=>[(U(),X(q,null,Z(De,o=>a(m,{key:o.label,cols:"12",class:"d-flex align-center"},{default:u(()=>[l("label",qe,p(o.label),1),a(c,{modelValue:o.model.value.value,"onUpdate:modelValue":n=>o.model.value.value=n,type:"text",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),64)),a(m,{cols:"3"},{default:u(()=>[e[18]||(e[18]=l("label",{class:"text-h6"},"調查員圖像",-1)),s.value.image?(U(),re(Ee,{key:0,src:s.value.image,alt:"調查員圖像","max-height":"200","max-width":"200",contain:"",onClick:t.triggerFileAgent},null,8,["src","onClick"])):je("",!0)]),_:1}),a(m,{cols:"3"},{default:u(()=>[e[19]||(e[19]=l("label",{class:"text-h6"},"上傳調查員圖像",-1)),a(B,{ref:"fileAgent",modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),"raw-model-value":ue.value,"onUpdate:rawModelValue":e[1]||(e[1]=o=>ue.value=o),accept:"image/jpeg, image/png",deletable:"","max-size":"1MB","help-text":"點擊選取圖片或拖曳圖片"},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1})]),l("section",Ge,[a(ge,{class:"border"},{default:u(()=>[l("thead",null,[l("tr",null,[(U(),X(q,null,Z(se,(o,n)=>l("th",{key:n,class:"text-h6"},p(o.label),1)),64))])]),l("tbody",null,[l("tr",null,[(U(),X(q,null,Z(se,(o,n)=>l("td",{key:n},[a(c,{modelValue:o.model.value.value,"onUpdate:modelValue":H=>o.model.value.value=H,type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),64))])])]),_:1})]),l("section",Je,[a(V,{align:"center",class:"ml-1"},{default:u(()=>[a(m,{cols:"3"},{default:u(()=>[l("label",Qe,"Idea："+p(v.value.idea),1)]),_:1}),a(m,{cols:"3"},{default:u(()=>[l("label",Ye,"Know："+p(v.value.know),1)]),_:1}),a(m,{cols:"3"},{default:u(()=>[l("label",el,"Luck："+p(v.value.luck),1)]),_:1}),a(m,{cols:"3"},{default:u(()=>[l("label",ll,"DB："+p(Se.value),1)]),_:1})]),_:1})]),l("section",al,[a(V,{align:"center",class:"ml-1"},{default:u(()=>[a(m,{cols:"2"},{default:u(()=>[l("label",tl,"HP："+p(v.value.hp),1),a(c,{modelValue:d(j).value.value,"onUpdate:modelValue":e[2]||(e[2]=o=>d(j).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1}),a(m,{cols:"2",class:"text-h6"},{default:u(()=>[l("label",null,"MP："+p(v.value.mp),1),a(c,{modelValue:d(K).value.value,"onUpdate:modelValue":e[3]||(e[3]=o=>d(K).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1}),a(m,{cols:"2"},{default:u(()=>[l("label",nl,"SAN："+p(v.value.san),1),a(c,{modelValue:d(L).value.value,"onUpdate:modelValue":e[4]||(e[4]=o=>d(L).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),a(T),l("section",ol,[a(V,{justify:"start",align:"center"},{default:u(()=>[a(m,{cols:"2"},{default:u(()=>e[20]||(e[20]=[l("label",{class:"text-h4"},"技能",-1)])),_:1}),a(m,{cols:"4"},{default:u(()=>[l("label",sl,"職業技能點數："+p(v.value.occupationpoints)+"/"+p(v.value.moveoccupationpoints),1)]),_:1}),a(m,{cols:"4"},{default:u(()=>[l("label",ul,"興趣技能點數："+p(v.value.interestpoints)+"/"+p(v.value.moveinterestpoints),1)]),_:1})]),_:1})]),l("section",dl,[a(ge,{class:"border"},{default:u(()=>[e[24]||(e[24]=l("thead",null,[l("tr",null,[l("th",null,"技能"),l("th",null,"初始值"),l("th",null,"職業P"),l("th",null,"興趣P"),l("th",null,"成長P"),l("th",null,"合計")])],-1)),l("tbody",null,[l("tr",null,[e[21]||(e[21]=l("td",null,"偵查",-1)),l("td",null,p(be)),l("td",null,[a(c,{modelValue:d(h).value.value,"onUpdate:modelValue":e[5]||(e[5]=o=>d(h).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,[a(c,{modelValue:d(y).value.value,"onUpdate:modelValue":e[6]||(e[6]=o=>d(y).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,[a(c,{modelValue:d(A).value.value,"onUpdate:modelValue":e[7]||(e[7]=o=>d(A).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,p(v.value.totalspothidden),1)]),l("tr",null,[e[22]||(e[22]=l("td",null,"聆聽",-1)),l("td",null,p(Ve)),l("td",null,[a(c,{modelValue:d(x).value.value,"onUpdate:modelValue":e[8]||(e[8]=o=>d(x).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,[a(c,{modelValue:d(_).value.value,"onUpdate:modelValue":e[9]||(e[9]=o=>d(_).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,[a(c,{modelValue:d(P).value.value,"onUpdate:modelValue":e[10]||(e[10]=o=>d(P).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,p(v.value.totallisten),1)]),l("tr",null,[e[23]||(e[23]=l("td",null,"圖書館使用",-1)),l("td",null,p(fe)),l("td",null,[a(c,{modelValue:d(k).value.value,"onUpdate:modelValue":e[11]||(e[11]=o=>d(k).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,[a(c,{modelValue:d(F).value.value,"onUpdate:modelValue":e[12]||(e[12]=o=>d(F).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,[a(c,{modelValue:d(z).value.value,"onUpdate:modelValue":e[13]||(e[13]=o=>d(z).value.value=o),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),l("td",null,p(v.value.totallibraryuse),1)])])]),_:1})]),a(T),l("section",il,[a(V,{justify:"start",align:"center"},{default:u(()=>[a(m,null,{default:u(()=>e[25]||(e[25]=[l("label",{class:"text-h4"},"背景故事",-1)])),_:1})]),_:1})]),l("section",rl,[a(V,null,{default:u(()=>[a(m,null,{default:u(()=>[a(Xe,{modelValue:d(O).value.value,"onUpdate:modelValue":e[14]||(e[14]=o=>d(O).value.value=o),type:"text",variant:"outlined","auto-grow":""},null,8,["modelValue"])]),_:1})]),_:1})]),a(T),a(me,null,{default:u(()=>[a($,{type:"submit",loading:d(b),variant:"outlined"},{default:u(()=>e[26]||(e[26]=[N(" 儲存 ")])),_:1},8,["loading"]),a(ce),a($,{color:"red",loading:d(b),variant:"outlined",onClick:de},{default:u(()=>e[27]||(e[27]=[N(" 刪除 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})}}};typeof ve=="function"&&ve(he);const xl=Pe(he,[["__scopeId","data-v-22c073ac"]]);export{xl as default};
