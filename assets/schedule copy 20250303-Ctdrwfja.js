import{ah as F,x as n,ab as E,a4 as o,a2 as w,c as t,aa as T,aC as C,b0 as P,a6 as m,ad as N,ax as D,aw as x,bs as h,aA as j,a9 as L,a5 as b,ac as O,ag as z}from"./index-DLbUNHb9.js";import{i as G,a as H,F as R,V as W}from"./VTimePicker-D-5UYKbT.js";import{V as X}from"./VContainer-B5SQmn9o.js";import{V as Y}from"./VDivider-x1LuGNcv.js";const _={__name:"schedule copy 20250303",setup(q){const{apiAuth:c}=z(),V=n([]),d=n(!1),y=n(""),r=n(""),v=n(""),i=n(""),s=n("12:00"),f=n(!1),g=n(""),u=n(null),$=n(""),p=n({plugins:[G,H],initialView:"dayGridMonth",editable:!0,events:V.value,displayEventTime:!1,dateClick:I,eventClick:S,eventDrop:B,eventMouseEnter:U});function U(a){const e=a.event;$.value=`劇本: ${e.title}<br>玩家: ${e.extendedProps.player}<br>角色: ${e.extendedProps.chara}<br>時間: ${e.extendedProps.time}`;const l=document.createElement("div");l.innerHTML=$.value,l.style.position="absolute",l.style.backgroundColor="rgba(0, 0, 0, 0.7)",l.style.color="white",l.style.padding="10px",l.style.borderRadius="4px",l.style.zIndex="1000",l.style.top=`${a.jsEvent.pageY}px`,l.style.left=`${a.jsEvent.pageX}px`,document.body.appendChild(l),a.el.addEventListener("mouseleave",()=>{l.remove()})}function I(a){y.value="新增行程",r.value="",v.value="",i.value="",s.value="12:00",g.value=a.dateStr,u.value=null,d.value=!0}function S(a){y.value="編輯行程",r.value=a.event.title,v.value=a.event.extendedProps.player,i.value=a.event.extendedProps.chara,s.value=a.event.extendedProps.time,g.value=a.event.extendedProps.date,u.value=a.event,d.value=!0}async function A(){try{if(!r.value.trim()){alert("行程名稱不能為空");return}const a={title:r.value,player:v.value,chara:i.value,time:s.value,date:g.value};if(u.value){const e=u.value.id;await c.patch(`/schedule/${e}`,a)}else await c.post("/schedule",a);console.log(p.value.events),k(),console.log(p.value.events)}catch(a){console.log(a)}d.value=!1}async function M(){if(u.value&&confirm(`確定要刪除「${u.value.title}」嗎？`)){const a=u.value.id;p.value.events=p.value.events.filter(e=>e.id!==a);try{await c.delete(`/schedule/${a}`),d.value=!1}catch(e){console.log(e)}}}function B(a){alert(`行程「${a.event.title}」已移動到 ${a.event.start.toISOString().split("T")[0]}`)}const k=async()=>{try{const{data:a}=await c.get("/schedule");console.log(a.result);const e=a.result.map(l=>({id:l._id,title:l.title,player:l.player,chara:l.chara,time:l.time,date:l.date}));V.value.length=0,V.value.push(...e),console.log(V.value)}catch(a){console.log(a)}console.log()};return k(),(a,e)=>(w(),E(X,null,{default:o(()=>[t(C,{class:"calendar-wrapper","max-width":"800px"},{default:o(()=>[t(T(R),{options:p.value},null,8,["options"])]),_:1}),t(h,{modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=l=>d.value=l),"max-width":"400px"},{default:o(()=>[t(C,null,{default:o(()=>[t(P,null,{default:o(()=>[m(N(y.value),1)]),_:1}),t(D,null,{default:o(()=>[t(x,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),label:"劇本名稱"},null,8,["modelValue"]),t(x,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),label:"玩家名稱"},null,8,["modelValue"]),t(x,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l),label:"角色名稱"},null,8,["modelValue"]),t(x,{modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value=l),label:"選擇時間",readonly:"",onClick:e[4]||(e[4]=l=>f.value=!0)},null,8,["modelValue"]),t(h,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=l=>f.value=l),"max-width":"380px"},{default:o(()=>[t(C,null,{default:o(()=>[t(P,null,{default:o(()=>e[10]||(e[10]=[m("選擇時間")])),_:1}),t(D,null,{default:o(()=>[t(T(W),{modelValue:s.value,"onUpdate:modelValue":[e[5]||(e[5]=l=>s.value=l),e[6]||(e[6]=l=>f.value=!1)],format:"24hr"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(j,null,{default:o(()=>[t(L),u.value?(w(),E(b,{key:0,color:"red",onClick:M},{default:o(()=>e[11]||(e[11]=[m("刪除")])),_:1})):O("",!0),t(Y),t(b,{color:"grey",onClick:e[8]||(e[8]=l=>d.value=!1)},{default:o(()=>e[12]||(e[12]=[m("取消")])),_:1}),t(b,{color:"primary",onClick:A},{default:o(()=>e[13]||(e[13]=[m("確定")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ee=F(_,[["__scopeId","data-v-d62a18db"]]);export{ee as default};
