import{ah as fe,$ as he,x as I,o as K,ab as ve,a4 as s,a0 as be,ag as ge,a1 as _e,a2 as V,c as l,az as Ve,aa as u,aA as O,aB as xe,aC as L,a5 as H,a6 as W,al as a,a3 as D,a8 as S,a7 as P,ad as i,ay as m,aD as ye}from"./index-BIOJ7wy9.js";import{c as we,a as f,b as p,u as Fe,d,V as ke}from"./index.esm-EU4o9Pf6.js";import{b as X}from"./route-block-B_A1xBdJ.js";import{V as Ue}from"./VContainer-BzB05Dvr.js";import{V as A}from"./VDivider-B64AXrpT.js";import{V as x,a as r}from"./VRow-DUv8sevy.js";import{V as Z}from"./VTable-DRSk5jhg.js";const De={class:"my-6"},Se={class:"text-h6 mr-2"},Pe={class:"my-6"},Ae={class:"my-6"},Be={class:"text-h6"},Ce={class:"text-h6"},Ne={class:"text-h6"},ze={class:"text-h6"},Me={class:"my-6"},Te={class:"text-h6"},$e={class:"text-h6"},Ee={class:"my-6"},Re={class:"text-h6"},je={class:"text-h6"},Ie={class:"my-6"},q=25,G={__name:"charasheetNew copy 20250228",setup(Ke){const J=be(),{apiAuth:Q}=ge(),B=he(),Y=we({investigator_name:f().default(""),occupation:f().default(""),colleges_degrees:f().default(""),birthplace:f().default(""),mental_disorders:f().default(""),sex:f().default(""),age:f().default(""),str:p().integer().default(0),con:p().integer().default(0),pow:p().integer().default(0),dex:p().integer().default(0),app:p().integer().default(0),siz:p().integer().default(0),int:p().integer().default(0),edu:p().integer().default(0),hp:p().integer().default(0),mp:p().integer().default(0),san:p().integer().default(0),opspothidden:p().integer().default(0),ipspothidden:p().integer().default(0),gpspothidden:p().integer().default(0)}),{handleSubmit:ee,isSubmitting:y}=Fe({validationSchema:Y}),te=d("investigator_name"),ae=d("occupation"),le=d("colleges_degrees"),oe=d("birthplace"),ne=d("mental_disorders"),se=d("sex"),de=d("age"),C=d("str"),N=d("con"),v=d("pow"),ue=d("dex"),ie=d("app"),w=d("siz"),F=d("int"),k=d("edu"),z=d("hp"),M=d("mp"),T=d("san"),b=d("opspothidden"),g=d("ipspothidden"),U=d("gpspothidden"),h=I([]),$=I([]),pe=[{label:"姓名",model:te},{label:"職業",model:ae},{label:"學校・學位",model:le},{label:"出身",model:oe},{label:"精神障害",model:ne},{label:"性別",model:se},{label:"年齡",model:de}],E=[{label:"STR",model:C},{label:"CON",model:N},{label:"POW",model:v},{label:"DEX",model:ue},{label:"APP",model:ie},{label:"SIZ",model:w},{label:"INT",model:F},{label:"EDU",model:k}],c=K(()=>({idea:parseFloat(F.value.value*5)||0,know:parseFloat(k.value.value*5)||0,luck:parseFloat(v.value.value*5)||0,hp:Math.ceil(((parseFloat(N.value.value)||0)+(parseFloat(w.value.value)||0))/2),mp:parseFloat(v.value.value)||0,san:parseFloat(v.value.value*5)||0,occupationpoints:parseFloat(k.value.value)*20||0,moveoccupationpoints:parseFloat(b.value.value)||0,interestpoints:parseFloat(F.value.value)*10||0,moveinterestpoints:parseFloat(g.value.value)||0,totalspothidden:q+(parseFloat(b.value.value)||0)+(parseFloat(g.value.value)||0)+(parseFloat(U.value.value)||0)})),re=K(()=>{const t=(parseFloat(C.value.value)||0)+(parseFloat(w.value.value)||0);return t<=12?"-1D6":t<=16?"-1D4":t<=24?"0":t<=32?"+1D4":t<=40?"+1D6":`+${Math.floor((t-25)/16)+1}D6`}),ce=ee(async t=>{var o,_,n;try{console.log("按完送出:",t),Object.keys(t).forEach(j=>{t[j]===void 0&&(t[j]="")});const e=new FormData;e.append("investigator_name",t.investigator_name),e.append("occupation",t.occupation),e.append("colleges_degrees",t.colleges_degrees),e.append("birthplace",t.birthplace),e.append("mental_disorders",t.mental_disorders),e.append("sex",t.sex),e.append("age",t.age),e.append("str",t.str),e.append("con",t.con),e.append("pow",t.pow),e.append("dex",t.dex),e.append("app",t.app),e.append("siz",t.siz),e.append("int",t.int),e.append("edu",t.edu),e.append("idea",t.idea),e.append("know",t.know),e.append("luck",t.luck),e.append("db",t.db),e.append("hp",t.hp),e.append("mp",t.mp),e.append("san",t.san),e.append("opspothidden",t.opspothidden),e.append("ipspothidden",t.ipspothidden),e.append("gpspothidden",t.gpspothidden),e.append("spothidden",t.spothidden),e.append("listen",t.listen),e.append("libraryuse",t.libraryuse),h.value.length>0&&((o=h.value[0])!=null&&o.file)&&e.append("image",h.value[0].file);const me=(await Q.post("/charasheetsix",e)).data.result._id;B({text:"保存成功",snackbarProps:{color:"green"}}),J.push(`/charasheetsix/${me}`)}catch(e){console.log(e),B({text:((n=(_=e==null?void 0:e.response)==null?void 0:_.data)==null?void 0:n.message)||"unknownError",snackbarProps:{color:"red"}})}});return(t,o)=>{const _=_e("VueFileAgent");return V(),ve(Ue,{width:"800px",fluid:""},{default:s(()=>[l(ye,{"max-width":"auto",class:"mx-auto",variant:"text"},{default:s(()=>[l(Ve,null,{default:s(()=>[l(ke,{disabled:u(y),onSubmit:O(u(ce),["prevent"]),onKeydown:o[8]||(o[8]=xe(O(()=>{},["prevent"]),["enter"]))},{default:s(()=>[l(L,null,{default:s(()=>[l(H,{type:"submit",loading:u(y),variant:"outlined"},{default:s(()=>o[9]||(o[9]=[W(" 儲存 ")])),_:1},8,["loading"])]),_:1}),l(A),a("section",De,[l(x,{align:"center",justify:"center"},{default:s(()=>[(V(),D(P,null,S(pe,n=>l(r,{key:n.label,cols:"12",class:"d-flex align-center"},{default:s(()=>[a("label",Se,i(n.label),1),l(m,{modelValue:n.model.value.value,"onUpdate:modelValue":e=>n.model.value.value=e,type:"text",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),64)),l(r,{cols:"3"},{default:s(()=>[o[10]||(o[10]=a("label",{class:"text-h6"},"調查員圖像",-1)),l(_,{ref:"fileAgent",modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=n=>h.value=n),"raw-model-value":$.value,"onUpdate:rawModelValue":o[1]||(o[1]=n=>$.value=n),accept:"image/jpeg, image/png",deletable:"","max-size":"1MB","help-text":"點擊選取圖片或拖曳圖片"},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1})]),a("section",Pe,[l(Z,{class:"border"},{default:s(()=>[a("thead",null,[a("tr",null,[(V(),D(P,null,S(E,(n,e)=>a("th",{key:e,class:"text-h6"},i(n.label),1)),64))])]),a("tbody",null,[a("tr",null,[(V(),D(P,null,S(E,(n,e)=>a("td",{key:e},[l(m,{modelValue:n.model.value.value,"onUpdate:modelValue":R=>n.model.value.value=R,type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),64))])])]),_:1})]),a("section",Ae,[l(x,{align:"center",class:"ml-1"},{default:s(()=>[l(r,{cols:"3"},{default:s(()=>[a("label",Be,"Idea："+i(c.value.idea),1)]),_:1}),l(r,{cols:"3"},{default:s(()=>[a("label",Ce,"Know："+i(c.value.know),1)]),_:1}),l(r,{cols:"3"},{default:s(()=>[a("label",Ne,"Luck："+i(c.value.luck),1)]),_:1}),l(r,{cols:"3"},{default:s(()=>[a("label",ze,"DB："+i(re.value),1)]),_:1})]),_:1})]),a("section",Me,[l(x,{align:"center",class:"ml-1"},{default:s(()=>[l(r,{cols:"2"},{default:s(()=>[a("label",Te,"HP："+i(c.value.hp),1),l(m,{modelValue:u(z).value.value,"onUpdate:modelValue":o[2]||(o[2]=n=>u(z).value.value=n),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1}),l(r,{cols:"2",class:"text-h6"},{default:s(()=>[a("label",null,"MP："+i(c.value.mp),1),l(m,{modelValue:u(M).value.value,"onUpdate:modelValue":o[3]||(o[3]=n=>u(M).value.value=n),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1}),l(r,{cols:"2"},{default:s(()=>[a("label",$e,"SAN："+i(c.value.san),1),l(m,{modelValue:u(T).value.value,"onUpdate:modelValue":o[4]||(o[4]=n=>u(T).value.value=n),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1})]),l(A),a("section",Ee,[l(x,{justify:"start",align:"center"},{default:s(()=>[l(r,{cols:"2"},{default:s(()=>o[11]||(o[11]=[a("label",{class:"text-h4"},"技能",-1)])),_:1}),l(r,{cols:"4"},{default:s(()=>[a("label",Re,"職業技能點數："+i(c.value.occupationpoints)+"/"+i(c.value.moveoccupationpoints),1)]),_:1}),l(r,{cols:"4"},{default:s(()=>[a("label",je,"興趣技能點數："+i(c.value.interestpoints)+"/"+i(c.value.moveinterestpoints),1)]),_:1})]),_:1})]),a("section",Ie,[l(Z,{class:"border"},{default:s(()=>[o[13]||(o[13]=a("thead",null,[a("tr",null,[a("th",null,"技能"),a("th",null,"初始值"),a("th",null,"職業P"),a("th",null,"興趣P"),a("th",null,"成長P"),a("th",null,"合計")])],-1)),a("tbody",null,[a("tr",null,[o[12]||(o[12]=a("td",null,"偵查",-1)),a("td",null,i(q)),a("td",null,[l(m,{modelValue:u(b).value.value,"onUpdate:modelValue":o[5]||(o[5]=n=>u(b).value.value=n),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),a("td",null,[l(m,{modelValue:u(g).value.value,"onUpdate:modelValue":o[6]||(o[6]=n=>u(g).value.value=n),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),a("td",null,[l(m,{modelValue:u(U).value.value,"onUpdate:modelValue":o[7]||(o[7]=n=>u(U).value.value=n),type:"number",density:"compact",variant:"outlined","hide-spin-buttons":!0,"hide-details":""},null,8,["modelValue"])]),a("td",null,i(c.value.totalspothidden),1)])])]),_:1})]),l(A),l(L,null,{default:s(()=>[l(H,{type:"submit",loading:u(y),variant:"outlined"},{default:s(()=>o[14]||(o[14]=[W(" 儲存 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1})}}};typeof X=="function"&&X(G);const Ge=fe(G,[["__scopeId","data-v-d4050725"]]);export{Ge as default};
